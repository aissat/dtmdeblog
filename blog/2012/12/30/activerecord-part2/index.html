
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title> مدخل إلى  Activerecord: العلاقات - مدونة الطيب الضادي</title>
  <meta name="author" content="طيب مرابطي">

  
  <meta name="description" content="قاعدة بيانات علائقية بدون تبادل مرجعي (cross-referencing) بين الجداول لا يعني الشيء الكثير. في مثال الجزء الأول المقال داخل المدونة (Post) يمكن أن &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tayeb83.github.com/dtmdeblog/blog/2012/12/30/activerecord-part2">
  <link href="/dtmdeblog/favicon.png" rel="icon">
  <link href="/dtmdeblog/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/dtmdeblog/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/dtmdeblog/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/dtmdeblog/javascripts/libs/jquery.js"></script>
  <script src="/dtmdeblog/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/dtmdeblog/javascripts/libs/bootstrap.js"></script>
  <script src="/dtmdeblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/dtmdeblog/atom.xml" rel="alternate" title="مدونة الطيب الضادي" type="application/atom+xml">
  
  

</head>

<body    style="direction: rtl">
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

     

      <div class="nav-collapse">
         
        <ul class="nav pull-right">
  <li><a href="/dtmdeblog/blog/archives">الأرشيف</a></li>
  <li><a href="/dtmdeblog/">المدونة</a></li>
  <li><a href="/dtmdeblog/about">من أنا؟</a></li>
  <a href="/dtmdeblog/"><img src="/dtmdeblog/images/lowres.jpg"></a>

</ul>


        <ul class="nav pull-right" data-subscription="rss email">
          <li><a href="/dtmdeblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
            <li><a href="tayeb.merabti@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="http://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:tayeb83.github.com/dtmdeblog" />
              <input class="search-query" type="text" name="q" results="0" placeholder="ابحث"/>
            </fieldset>
          </form>
        
      </div>
     
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">مدخل إلى Activerecord: العلاقات</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-30T22:49:00+01:00" pubdate data-updated="true">Dec 30<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>قاعدة بيانات علائقية بدون تبادل مرجعي (cross-referencing) بين الجداول  لا يعني الشيء الكثير. في مثال الجزء الأول المقال داخل المدونة (Post) يمكن أن يحوي على أكثر من تعليق أو لا يحوي أي تعليق. التعليق و الذي سيُمثل بجدول في قاعدة البيانات يحتوي على عمود (post_id) يُمكن من خلاله ربط التعليق بالمقال. الActiverecord يرعى هذه العلاقات بالنسبة لنا ويجعلها شفافة لحد كبير و لدرجة أننا لن نحتاج إلى لمس الSQL.
هناك مجموعة من العلاقات يستطيع الActiverecord إدارتها من بينها :</p>

<h2>belongs_to : </h2>

<p>تعتبر العلاقة الأكثر إستعمالا في قاعدة البيانات. قولنا بأن النوع أ ينتمي إلى النوع ب هذا يعني أن النوع أ يحتوي على عمود ID مرجعي للنوع ب. مثال ذلك، أنه داخل المدونة الPost يحتوي على أكثر من تعليق (Comments) أي بمعنى أخر أن التعليق ينتمي لPost واحد فهذا يعني أن الجدول الذي يمثل الComment سوف يحتوي على العمود Post_Id والذي يُشير إلى الPost الذي يحوي التعليق. النتيجة أنه إذا كان لك كائن يُمثل تعليقا من التعليقات (c)  فإنه بإمكاننا إستخراج الPost الموافق عن طريق الأمر : c.Post و النتيجة أيضا أن حذف الPost يعني مباشرة حذف التعليقات التي تنتمي إليه.</p>

<h2>has_many : </h2>

<p>تُعبر العلاقة عن الطرف الأخر للعلاقة belongs_to. في المثال السابق كان بإمكاننا القول : التعليق ينتمي إلى مقال (belongs_to) أو المقال له مجموعة من التعليقات (has_many). المقال لا يحتفظ بجدول يحتوي على التعليقات التي تنتمي إليه، ولكن بكل بساطة يستعلم داخل جدول التعليقات و يستخرج تلك التي تتعلق به. فمثلا من أجل المقال p التعليقات الخاصة به ستُحفظ داخل جدول عن طريق الأمر : p.comments.</p>

<h2>has_one : </h2>

<p>هذه العلاقة تشبه إلى حد كبير العلاقة has_many، باستثناء أن العلاقة تربط بين كائنين فقط أي علاقة واحد-واحد. فمثلا داخل تطبيق،  المستعمل له حساب واحد و واحد فقط في هذه الحالة نموذج المستعمل سيربط بالنموذج الخاص بالحساب بواسطة العلاقة has_one. وبالتالي العلاقة تفرض وحدانية الحساب الخاص بكل مستعمل أي أنه إذا أردنا مثلا إضافة
حساب آخر فهذا خطأ.</p>

<h2>has_many :through Association :</h2>

<p> تستعمل هذه العلاقة لإعداد العلاقة مجموعة إلى مجموعة (many to many) بواسطة نموذج وسط. العلاقة تشير إلى أن النموذج المعلن يمكن ربطه مع صفر أو أكثر من حالة لنموذج ثاني بواسطة نموذج ثالث وسط. لنفرض مثلا أننا نريد معرفة ثمن الحليب الذي يبيعه المربي لبائعي التجزئة. الأمر كان سهلا لو كان الثمن ثابت بحيث أنه كان بإمكاننا جعل ثمن الحليب عبارة عن عمود داخل الجدول الخاص بالمربي فقط  ولكن هذا غير صحيح لأن الثمن غير ثابت و يختلف باختلاف بائعي التجزئة أو لأن البائع يشتري الحليب بأثمان مختلفة باختلاف المربين، في هذه الحالة يمكننا استعمال العلاقة    has_many :through ، لأنه يجب تعريف نموذج وسط بين البائع و المربي يعبر عن عملية التوزيع DISTRIBUTION.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Reseller &lt; ActiveRecord::Base
</span><span class='line'>  has_many :distributions
</span><span class='line'>  has_many :farmers, :through => :distributions
</span><span class='line'>end
</span><span class='line'>class Distributions &lt; ActiveRecord::Base    
</span><span class='line'>  belongs_to :reseller
</span><span class='line'>  belongs_to :farmer
</span><span class='line'>end
</span><span class='line'>class Farmer &lt; ActiveRecord::Base
</span><span class='line'>  has_many :distributions
</span><span class='line'>  has_many :resellers, :through => :distributions
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h2>  has_and_belong_to_many : </h2>

<p>هذه العلاقة تُعتبر مُعقدة نوع ما. المثال التقليدي هو &#8220;الوسمات&#8221;. بمعنى أن المقال له مجموعة من الوسمات و الوسام يمكن أن ينتمي إلى مجموعة مقالات مختلفة، أي أن العلاقة  هي has_many بين الوسام و المقال بدون نموذج وسط.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">طيب مرابطي</span></span>

      








  


<time datetime="2012-12-30T22:49:00+01:00" pubdate data-updated="true">Dec 30<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/dtmdeblog/blog/categories/activerecord-/'>activerecord,</a>, <a class='category' href='/dtmdeblog/blog/categories/rails-/'>rails,</a>, <a class='category' href='/dtmdeblog/blog/categories/relations/'>relations</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tayeb83.github.com/dtmdeblog/blog/2012/12/30/activerecord-part2/" data-via="dtmdeblog" data-counturl="http://tayeb83.github.com/dtmdeblog/blog/2012/12/30/activerecord-part2/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    
    <section>
      <h1>التعليقات</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/dtmdeblog/blog/2012/12/30/activerecord-part1/" title="Previous Post:
         مدخل إلى Activerecord : CRUD">&laquo;  مدخل إلى Activerecord : CRUD</a></li>
      
      <li><a href="/dtmdeblog/blog/archives">أرشيف المدونات</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/dtmdeblog/blog/2013/02/01/schema-definition/"
        title="Next Post: وضع مخطط لقاعدة بيانات">وضع مخطط لقاعدة بيانات
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">أخر التدوينات</li>
    
      <li class="post">
        <a href="/dtmdeblog/blog/2013/08/01/achiaa-tmanyt-t3lmha-1/">أشياء تمنيت تعلمها في الجامعة</a>
      </li>
    
      <li class="post">
        <a href="/dtmdeblog/blog/2013/07/31/zeus-rails/">تسريع التعامل مع أوامر rails</a>
      </li>
    
      <li class="post">
        <a href="/dtmdeblog/blog/2013/07/06/ruby-prime-number/">تعبير نمطي بروبي يساعدك في معرفة ما إذا كان أي عدد أولي أم لا</a>
      </li>
    
      <li class="post">
        <a href="/dtmdeblog/blog/2013/06/10/regexp-ruby-p2/">التعابير النمطية و روبي - الجزء الثاني</a>
      </li>
    
      <li class="post">
        <a href="/dtmdeblog/blog/2013/05/21/regexp-ruby/">التعابير النمطية و روبي - الجزء الأول</a>
      </li>
    
  </ul>
</section>


<section class="well">
  <ul id="tweets" class="nav">
    <li class="nav-header">أخر التغريدات</li>
    <li class="loading">تحديث ...</li>
  </ul>
  <script type="text/javascript">
    $(document).ready(function(){
      getTwitterFeed("dtmdeblog", 4, false);
    });
  </script>
  <script src="/dtmdeblog/javascripts/asides/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/dtmdeblog" class="twitter-follow-button" data-show-count="false">تابع @dtmdeblog</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101099896157910648102?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  جميع الحقوق محفوظة &copy; 2013 - طيب مرابطي -
  <span class="credit">انجز باستعمال <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dtmdeblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tayeb83.github.com/dtmdeblog/blog/2012/12/30/activerecord-part2/';
        var disqus_url = 'http://tayeb83.github.com/dtmdeblog/blog/2012/12/30/activerecord-part2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
